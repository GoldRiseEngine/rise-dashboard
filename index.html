<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rise Trading Dashboard</title>
    <link rel="icon" type="image/png" href="rise_trading_watermark_dark.png">
    <link rel="apple-touch-icon" href="rise_trading_watermark_dark.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4A9B7F;
            --primary-dark: #3D8269;
            --primary-light: #5FB896;
            --primary-glow: rgba(74, 155, 127, 0.4);
            --bg-dark: #0a0f0d;
            --bg-card: rgba(74, 155, 127, 0.03);
            --bg-card-hover: rgba(74, 155, 127, 0.08);
            --border: rgba(74, 155, 127, 0.15);
            --border-hover: rgba(74, 155, 127, 0.3);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-muted: rgba(255, 255, 255, 0.35);
            --green: #00D26A;
            --green-glow: rgba(0, 210, 106, 0.3);
            --red: #FF4757;
            --red-glow: rgba(255, 71, 87, 0.3);
            --trades-bg: rgba(0, 0, 0, 0.3);
            --watermark-opacity: 0.07;
            --watermark-filter: brightness(1.5) saturate(0.8);
            --logo-filter: brightness(1.3) saturate(0.9);
        }

        [data-theme="light"] {
            --bg-dark: #f5f7f6;
            --bg-card: rgba(74, 155, 127, 0.06);
            --bg-card-hover: rgba(74, 155, 127, 0.12);
            --border: rgba(74, 155, 127, 0.2);
            --border-hover: rgba(74, 155, 127, 0.4);
            --text-primary: #1a2520;
            --text-secondary: rgba(26, 37, 32, 0.7);
            --text-muted: rgba(26, 37, 32, 0.45);
            --green: #00a854;
            --green-glow: rgba(0, 168, 84, 0.25);
            --red: #e63946;
            --red-glow: rgba(230, 57, 70, 0.25);
            --trades-bg: rgba(74, 155, 127, 0.08);
            --watermark-opacity: 0.04;
            --watermark-filter: brightness(0.8) saturate(0.6);
            --logo-filter: brightness(0.9) saturate(1.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; }
        body {
            font-family: 'Outfit', -apple-system, sans-serif;
            background: var(--bg-dark);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            transition: background 0.3s ease, color 0.3s ease;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 20% 40%, rgba(74, 155, 127, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 60%, rgba(74, 155, 127, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        [data-theme="light"] body::before {
            background: 
                radial-gradient(ellipse 80% 50% at 20% 40%, rgba(74, 155, 127, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 60%, rgba(74, 155, 127, 0.05) 0%, transparent 50%);
        }

        .watermark {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 70vw;
            max-width: 800px;
            opacity: var(--watermark-opacity);
            pointer-events: none;
            z-index: 0;
            filter: var(--watermark-filter);
            transition: opacity 0.3s ease, filter 0.3s ease;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; position: relative; z-index: 1; }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo-section { display: flex; align-items: center; gap: 0.75rem; }
        .logo-img { height: 100px; width: auto; filter: var(--logo-filter); transition: filter 0.3s ease; }

        .header-right { display: flex; align-items: center; gap: 1rem; }
        .header-info { text-align: right; }
        .last-updated { font-size: 0.75rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: rgba(0, 210, 106, 0.1);
            border: 1px solid rgba(0, 210, 106, 0.3);
            border-radius: 100px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--green);
            margin-bottom: 0.5rem;
        }

        .status-dot {
            width: 6px; height: 6px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 var(--green-glow); }
            50% { opacity: 0.7; box-shadow: 0 0 0 8px transparent; }
        }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .theme-toggle:hover {
            border-color: var(--border-hover);
            background: var(--bg-card-hover);
            color: var(--primary);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover svg {
            transform: rotate(15deg);
        }

        .theme-toggle .sun-icon { display: none; }
        .theme-toggle .moon-icon { display: block; }

        [data-theme="light"] .theme-toggle .sun-icon { display: block; }
        [data-theme="light"] .theme-toggle .moon-icon { display: none; }

        .stats-section { margin-bottom: 2rem; }
        .section-label { font-size: 0.7rem; font-weight: 600; letter-spacing: 3px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 1rem; }

        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        @media (max-width: 900px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 500px) { .stats-grid { grid-template-columns: 1fr; } }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.25rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -20px var(--primary-glow);
        }

        .stat-card:hover::before { opacity: 1; }

        .stat-card.highlight {
            background: linear-gradient(135deg, rgba(74, 155, 127, 0.1) 0%, rgba(74, 155, 127, 0.02) 100%);
            border-color: var(--primary);
        }

        .stat-label { font-size: 0.7rem; font-weight: 500; letter-spacing: 1px; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .stat-value { font-size: 2rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; line-height: 1; }
        .stat-value.positive { color: var(--green); text-shadow: 0 0 30px var(--green-glow); }
        .stat-value.negative { color: var(--red); text-shadow: 0 0 30px var(--red-glow); }
        .stat-value.neutral { color: var(--text-primary); }
        .stat-value.primary { color: var(--primary); text-shadow: 0 0 30px var(--primary-glow); }
        .stat-subtext { font-size: 0.7rem; color: var(--text-muted); margin-top: 0.5rem; font-family: 'JetBrains Mono', monospace; }

        .signals-section { margin-bottom: 2rem; }
        .signals-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .signals-title { font-size: 0.9rem; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 0.75rem; }
        .signals-count { font-size: 0.7rem; font-weight: 500; padding: 0.25rem 0.6rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 100px; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; }
        .signals-container { display: flex; flex-direction: column; gap: 0.5rem; }

        .signal-row {
            display: grid;
            grid-template-columns: 80px 110px 70px 90px 1fr 130px;
            gap: 1rem;
            padding: 1rem 1.25rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .signal-row:hover { background: var(--bg-card-hover); border-color: var(--border-hover); }
        @media (max-width: 800px) { .signal-row { grid-template-columns: 1fr 1fr; gap: 0.75rem; } }

        .signal-id { font-weight: 600; color: var(--primary); font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; }
        .signal-date { color: var(--text-muted); font-size: 0.8rem; font-family: 'JetBrains Mono', monospace; }

        .signal-direction { font-weight: 700; font-size: 0.75rem; letter-spacing: 1px; padding: 0.3rem 0.6rem; border-radius: 6px; text-align: center; }
        .signal-direction.buy { background: rgba(0, 210, 106, 0.15); color: var(--green); border: 1px solid rgba(0, 210, 106, 0.3); }
        .signal-direction.sell { background: rgba(255, 71, 87, 0.15); color: var(--red); border: 1px solid rgba(255, 71, 87, 0.3); }

        .signal-trades { color: var(--text-secondary); font-size: 0.8rem; }
        .signal-result { display: flex; gap: 0.75rem; font-size: 0.8rem; font-family: 'JetBrains Mono', monospace; }
        .signal-result .wins { color: var(--green); }
        .signal-result .losses { color: var(--red); }

        .signal-pnl { font-weight: 700; font-family: 'JetBrains Mono', monospace; text-align: right; display: flex; align-items: center; justify-content: flex-end; gap: 0.5rem; }
        .signal-pnl.positive { color: var(--green); }
        .signal-pnl.negative { color: var(--red); }

        .expand-icon { font-size: 0.7rem; color: var(--text-muted); transition: transform 0.2s; }
        .signal-row.expanded .expand-icon { transform: rotate(180deg); }

        .trades-detail {
            display: none;
            background: var(--trades-bg);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 12px 12px;
            margin-top: -0.5rem;
            margin-bottom: 0.5rem;
            padding: 1rem;
            animation: slideDown 0.2s ease;
        }

        .trades-detail.expanded { display: block; }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .trade-row {
            display: grid;
            grid-template-columns: 70px 70px 90px 90px 70px 90px;
            gap: 1rem;
            padding: 0.6rem 0.5rem;
            font-size: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-secondary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        [data-theme="light"] .trade-row {
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        .trade-row:last-child { border-bottom: none; }
        .trade-row.header { color: var(--text-muted); font-weight: 600; font-size: 0.65rem; letter-spacing: 1px; text-transform: uppercase; }

        .show-more-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.875rem;
            margin-top: 0.75rem;
            background: transparent;
            border: 1px dashed var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 500;
            font-family: 'Outfit', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
        }

        .show-more-btn:hover { border-color: var(--primary); color: var(--primary); background: rgba(74, 155, 127, 0.05); }

        .no-signals { text-align: center; padding: 3rem; color: var(--text-muted); font-size: 0.9rem; }
        .loading { text-align: center; padding: 3rem; color: var(--text-muted); }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px; height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
            vertical-align: middle;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stat-card, .signal-row { animation: fadeInUp 0.5s ease backwards; }
        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.15s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.25s; }
    </style>
</head>
<body>
    <img src="rise_trading_watermark_dark.png" class="watermark" alt="">

    <div class="container">
        <header class="header">
            <div class="logo-section">
                <img src="rise_trading_watermark_dark.png" class="logo-img" alt="Rise Trading">
            </div>
            <div class="header-right">
                <div class="header-info">
                    <div class="status-badge"><span class="status-dot"></span>LIVE</div>
                    <div class="last-updated" id="lastUpdated">Loading...</div>
                </div>
                <button class="theme-toggle" id="themeToggle" title="Toggle light/dark mode">
                    <svg class="moon-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                    </svg>
                    <svg class="sun-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                </button>
            </div>
        </header>

        <section class="stats-section">
            <div class="section-label">Performance Overview</div>
            <div class="stats-grid">
                <div class="stat-card highlight">
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-value primary" id="winRate">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total P/L</div>
                    <div class="stat-value" id="totalPnL">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Signals</div>
                    <div class="stat-value neutral" id="totalSignals">-</div>
                    <div class="stat-subtext"><span id="totalWins" style="color:var(--green)">-</span> W / <span id="totalLosses" style="color:var(--red)">-</span> L</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Trades</div>
                    <div class="stat-value neutral" id="totalTrades">-</div>
                </div>
            </div>
            <div class="stats-grid" style="margin-top: 1rem;">
                <div class="stat-card">
                    <div class="stat-label">Avg Win</div>
                    <div class="stat-value positive" id="avgWin">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Loss</div>
                    <div class="stat-value negative" id="avgLoss">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Best Signal</div>
                    <div class="stat-value positive" id="bestSignal">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Worst Signal</div>
                    <div class="stat-value negative" id="worstSignal">-</div>
                </div>
            </div>
        </section>

        <section class="signals-section">
            <div class="signals-header">
                <div class="signals-title">Today's Signals<span class="signals-count" id="todayCount">0</span></div>
            </div>
            <div class="signals-container" id="todaySignals"><div class="no-signals">No signals yet today</div></div>
        </section>

        <section class="signals-section">
            <div class="signals-header">
                <div class="signals-title">Previous Signals<span class="signals-count" id="prevCount">0</span></div>
            </div>
            <div class="signals-container" id="prevSignals"><div class="loading">Loading signals</div></div>
        </section>
    </div>

<script>
// Theme Toggle
(function() {
    var theme = localStorage.getItem('rise-theme') || 'dark';
    if (theme === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
    }
})();

document.getElementById('themeToggle').addEventListener('click', function() {
    var current = document.documentElement.getAttribute('data-theme');
    var next = current === 'light' ? 'dark' : 'light';
    if (next === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
    } else {
        document.documentElement.removeAttribute('data-theme');
    }
    localStorage.setItem('rise-theme', next);
});

var SHEET_ID = '1h___rcrQm4hncmA3iTxmJ5SZ_ZW4IvPKAgyFdw76SKI';
var TIMEZONE = 'America/Chicago';
var allPrevSignals = [];

function getCentralDate() {
    return new Date().toLocaleDateString('en-CA', {timeZone: TIMEZONE});
}

function formatDateCT(str) {
    if (!str) return '';
    var s = str.replace(/\./g, '-');
    var p = s.split(/-| |:/);
    if (p.length >= 3 && p[0].length === 4) {
        var utc = Date.UTC(parseInt(p[0]), parseInt(p[1]) - 1, parseInt(p[2]), parseInt(p[3]) || 0, parseInt(p[4]) || 0);
        return new Date(utc).toLocaleDateString('en-CA', {timeZone: TIMEZONE});
    }
    return str.split(' ')[0].replace(/\./g, '-');
}

function formatTimeCT(str) {
    if (!str) return '';
    var s = str.replace(/\./g, '-');
    var p = s.split(/-| |:/);
    if (p.length >= 5) {
        var utc = Date.UTC(parseInt(p[0]), parseInt(p[1]) - 1, parseInt(p[2]), parseInt(p[3]) || 0, parseInt(p[4]) || 0);
        return new Date(utc).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', timeZone: TIMEZONE});
    }
    return '';
}

async function fetchData() {
    try {
        var r = await fetch('https://docs.google.com/spreadsheets/d/' + SHEET_ID + '/gviz/tq?tqx=out:csv');
        var t = await r.text();
        var rows = parseCSV(t);
        if (rows.length > 1) processData(rows);
    } catch(e) {
        console.error(e);
        document.getElementById('prevSignals').innerHTML = '<div class="no-signals">Error loading data</div>';
    }
}

function parseCSV(t) {
    return t.trim().split('\n').map(function(line) {
        var res = [];
        var cell = '';
        var inQ = false;
        for (var i = 0; i < line.length; i++) {
            var c = line[i];
            if (c === '"') inQ = !inQ;
            else if (c === ',' && !inQ) {
                res.push(cell.trim().replace(/^"|"$/g, ''));
                cell = '';
            } else cell += c;
        }
        res.push(cell.trim().replace(/^"|"$/g, ''));
        return res;
    });
}

function processData(rows) {
    var headers = rows[0];
    var trades = rows.slice(1).map(function(row) {
        var o = {};
        headers.forEach(function(h, i) { o[h] = row[i] || ''; });
        return o;
    });
    
    var groups = {};
    trades.forEach(function(t) {
        var s = t['Signal #'] || '?';
        if (!groups[s]) groups[s] = [];
        groups[s].push(t);
    });

    var signals = Object.entries(groups).map(function(entry) {
        var n = entry[0];
        var tr = entry[1];
        var pnl = tr.reduce(function(s, t) { return s + parseFloat(t['Net P/L'] || 0); }, 0);
        var w = tr.filter(function(t) { return t['Result'] === 'WIN'; }).length;
        var l = tr.filter(function(t) { return t['Result'] === 'LOSS'; }).length;
        var openTime = tr[0]['Open Time'] || '';
        var dateCT = formatDateCT(openTime);
        return {
            signalNum: parseInt(n) || 0,
            trades: tr,
            totalPnL: pnl,
            wins: w,
            losses: l,
            direction: tr[0]['Direction'],
            date: dateCT,
            openTime: openTime,
            signalResult: pnl >= 0 ? 'WIN' : 'LOSS',
            tradeCount: tr.length
        };
    });

    signals.sort(function(a, b) { return b.signalNum - a.signalNum; });
    
    var tot = signals.length;
    var sW = signals.filter(function(s) { return s.signalResult === 'WIN'; }).length;
    var sL = signals.filter(function(s) { return s.signalResult === 'LOSS'; }).length;
    var wr = tot > 0 ? ((sW / tot) * 100).toFixed(1) : 0;
    var totPnL = signals.reduce(function(s, x) { return s + x.totalPnL; }, 0);
    var wSigs = signals.filter(function(s) { return s.signalResult === 'WIN'; });
    var lSigs = signals.filter(function(s) { return s.signalResult === 'LOSS'; });
    var avgW = wSigs.length ? wSigs.reduce(function(s, x) { return s + x.totalPnL; }, 0) / wSigs.length : 0;
    var avgL = lSigs.length ? lSigs.reduce(function(s, x) { return s + x.totalPnL; }, 0) / lSigs.length : 0;
    var bestSig = signals.length ? Math.max.apply(null, signals.map(function(s) { return s.totalPnL; })) : 0;
    var worstSig = signals.length ? Math.min.apply(null, signals.map(function(s) { return s.totalPnL; })) : 0;

    document.getElementById('totalSignals').textContent = tot;
    document.getElementById('totalWins').textContent = sW;
    document.getElementById('totalLosses').textContent = sL;
    document.getElementById('winRate').textContent = wr + '%';
    document.getElementById('winRate').className = 'stat-value ' + (parseFloat(wr) >= 50 ? 'primary' : 'negative');
    document.getElementById('totalPnL').textContent = '$' + totPnL.toFixed(2);
    document.getElementById('totalPnL').className = 'stat-value ' + (totPnL >= 0 ? 'positive' : 'negative');
    document.getElementById('avgWin').textContent = '$' + avgW.toFixed(2);
    document.getElementById('avgLoss').textContent = '$' + avgL.toFixed(2);
    document.getElementById('bestSignal').textContent = '$' + bestSig.toFixed(2);
    document.getElementById('worstSignal').textContent = '$' + worstSig.toFixed(2);
    document.getElementById('totalTrades').textContent = trades.length;

    var today = getCentralDate();
    var todayS = signals.filter(function(s) { return s.date === today; });
    var prevS = signals.filter(function(s) { return s.date !== today; });
    allPrevSignals = prevS;

    document.getElementById('lastUpdated').textContent = new Date().toLocaleString('en-US', {timeZone: TIMEZONE, month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit'}) + ' CT';
    document.getElementById('todayCount').textContent = todayS.length + ' signals • ' + todayS.reduce(function(s, x) { return s + x.tradeCount; }, 0) + ' trades';
    document.getElementById('todaySignals').innerHTML = todayS.length === 0 ? '<div class="no-signals">No signals yet today</div>' : todayS.map(renderSignal).join('');
    document.getElementById('prevCount').textContent = prevS.length + ' signals • ' + prevS.reduce(function(s, x) { return s + x.tradeCount; }, 0) + ' trades';
    renderPrev(5);
    addClicks();
}

function renderPrev(n) {
    var show = allPrevSignals.slice(0, n);
    var h = show.length === 0 ? '<div class="no-signals">No previous signals</div>' : show.map(renderSignal).join('');
    if (allPrevSignals.length > n) h += '<button class="show-more-btn" onclick="showAll()">Show All ' + allPrevSignals.length + ' Signals ↓</button>';
    document.getElementById('prevSignals').innerHTML = h;
    addClicks();
}

function showAll() {
    document.getElementById('prevSignals').innerHTML = allPrevSignals.map(renderSignal).join('') + '<button class="show-more-btn" onclick="renderPrev(5)">Show Less ↑</button>';
    addClicks();
}

function addClicks() {
    document.querySelectorAll('.signal-row').forEach(function(row) {
        row.onclick = function() {
            var d = this.nextElementSibling;
            if (d && d.classList.contains('trades-detail')) {
                d.classList.toggle('expanded');
                this.classList.toggle('expanded');
            }
        };
    });
}

function renderSignal(s) {
    var pc = s.totalPnL >= 0 ? 'positive' : 'negative';
    var dc = s.direction ? s.direction.toLowerCase() : '';
    var th = s.trades.map(function(t) {
        var time = formatTimeCT(t['Open Time']);
        var pnl = parseFloat(t['Net P/L'] || 0);
        return '<div class="trade-row"><div>' + time + '</div><div>' + parseFloat(t['Lots'] || 0).toFixed(2) + '</div><div>' + parseFloat(t['Entry'] || 0).toFixed(2) + '</div><div>' + parseFloat(t['Exit'] || 0).toFixed(2) + '</div><div style="color:' + (t['Result'] === 'WIN' ? 'var(--green)' : 'var(--red)') + '">' + t['Result'] + '</div><div style="color:' + (pnl >= 0 ? 'var(--green)' : 'var(--red)') + '">$' + pnl.toFixed(2) + '</div></div>';
    }).join('');
    return '<div class="signal-row"><div class="signal-id">#' + s.signalNum + '</div><div class="signal-date">' + s.date + '</div><div class="signal-direction ' + dc + '">' + (s.direction || '') + '</div><div class="signal-trades">' + s.tradeCount + ' trades</div><div class="signal-result"><span class="wins">' + s.wins + 'W</span><span class="losses">' + s.losses + 'L</span></div><div class="signal-pnl ' + pc + '">$' + s.totalPnL.toFixed(2) + ' <span class="expand-icon">▼</span></div></div><div class="trades-detail"><div class="trade-row header"><div>Time</div><div>Lots</div><div>Entry</div><div>Exit</div><div>Result</div><div>P/L</div></div>' + th + '</div>';
}

fetchData();
setInterval(fetchData, 60000);
</script>
</body>
</html>
